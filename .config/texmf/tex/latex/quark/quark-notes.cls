\NeedsTeXFormat{LaTeX2e}
\ProvidesClass{quark-notes}

\LoadClass[reqno]{scrartcl}
\RequirePackage[margin=1in]{geometry}

\RequirePackage{kvoptions}
\SetupKeyvalOptions {
  family=quark,
  prefix=quark@,
}

% Extra formatting to exclude from more formal documents
\DeclareBoolOption{extras}

% If true, number theorems by subsection instead of section
\DeclareBoolOption{long}

\DeclareOption*{\PassOptionsToClass{\CurrentOption}{scrartcl}}
\DeclareDefaultOption{\PassOptionsToClass{\CurrentOption}{scrartcl}}
\ProcessOptions\relax
\ProcessKeyvalOptions*

%\addtokomafont{disposition}{\normalfont\bfseries}
\RequirePackage{iftex}
\iftutex
  % Haven't yet found how to fix missing \lrcorner character
  % Says it's missing in Latin Modern, but present when using pdflatex
  \RequirePackage{fontspec}
  \setmainfont{ETbb}
  \setmathfont{Latin Modern Math}
  \newfontfamily\symbolsfont{Symbola}
\else
  \usepackage[T1]{fontenc}
  \RequirePackage[full]{textcomp} % Seems necessary for certain fonts
  \RequirePackage{lmodern}
  \RequirePackage{ETbb}
\fi

\RequirePackage[british]{babel}
\RequirePackage[
  %backref = true,
  maxnames = 4,
  maxalphanames = 4,
  style = alphabetic,
] {biblatex}

% See https//www.khirevich.com/latex/microtype/
\RequirePackage[
    %, stretch  = 10, shrink = 10         % Variation of character width (default 20)
]{microtype}
\SetProtrusion{encoding={*},family={bch},series={*},size={6,7}}
              {1={ ,750},2={ ,500},3={ ,500},4={ ,500},5={ ,500},
               6={ ,500},7={ ,600},8={ ,500},9={ ,500},0={ ,500}}

\RequirePackage{amsmath,amsthm}

% Should be imported after most other packages
\RequirePackage{hyperref}

% Cleveref must be loaded after amsthm and hyperref, but before any theorem environment definitions.
% If a version of the source is needed without the cleveref dependency, a sed script to hardcode its
% effects can be generated by passing the 'poorman' option.
\RequirePackage[capitalise,noabbrev]{cleveref}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{eg}[theorem]{Example}

\theoremstyle{remark}
\newtheorem*{remark}{Remark}

\crefname{eg}{Example}{Examples}
\creflabelformat{equation}{#2\textup{#1}#3}

\RequirePackage{quark-macros}
\ifquark@extras
  \RequirePackage{quark-extras}
\fi

% Make maths match the boldness of the surrounding text
% https://tex.stackexchange.com/a/124311
% Note: egreg's answer to the same question looks more targetted, and may end up being preferable if I want to avoid bold maths in bold body text. But I doubt I'll ever want maths in bold body text anyway.
\makeatletter
\g@addto@macro\bfseries{\boldmath}
\makeatother

% Requires LuaTeX or XeTeX.
% \RequirePackage{unicode-math}  % Fix incorrect rendering of =>
% \RequirePackage{fontspec}
% \setmainfont{ETbb}
% \newfontfamily\symbolsfont{Symbola}
